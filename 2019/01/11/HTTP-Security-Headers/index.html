<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>
























  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.1"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/imgs/avatar.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/imgs/favicon.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/imgs/favicon.png?v=7.0.1">


  <link rel="mask-icon" href="/imgs/logo.png?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="原文：Hardening Website Security – Part 1: HTTP Security Headers  简介感觉每周都会出现新的个人信息被盗事件，原因是某一家公司网站被黑了。    大部分攻击都是通过社会工程学诱骗某些用户主动提交一些信息，黑客借助这些信息获取更高权限并最终获取个人资料。    如果你想要在21世纪运营一个安全的网站，你需要遵循一些安全准则，我会写一个系列专">
<meta name="keywords" content="Web,HTTP,Headers,Security">
<meta property="og:type" content="article">
<meta property="og:title" content="强化网站安全 - 第一篇：安全相关的Headers (Hardening Website Security – Part 1: HTTP Security Headers)">
<meta property="og:url" content="http://mrzzcn.github.io/2019/01/11/HTTP-Security-Headers/index.html">
<meta property="og:site_name" content="随笔">
<meta property="og:description" content="原文：Hardening Website Security – Part 1: HTTP Security Headers  简介感觉每周都会出现新的个人信息被盗事件，原因是某一家公司网站被黑了。    大部分攻击都是通过社会工程学诱骗某些用户主动提交一些信息，黑客借助这些信息获取更高权限并最终获取个人资料。    如果你想要在21世纪运营一个安全的网站，你需要遵循一些安全准则，我会写一个系列专">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-04-27T01:43:35.927Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="强化网站安全 - 第一篇：安全相关的Headers (Hardening Website Security – Part 1: HTTP Security Headers)">
<meta name="twitter:description" content="原文：Hardening Website Security – Part 1: HTTP Security Headers  简介感觉每周都会出现新的个人信息被盗事件，原因是某一家公司网站被黑了。    大部分攻击都是通过社会工程学诱骗某些用户主动提交一些信息，黑客借助这些信息获取更高权限并最终获取个人资料。    如果你想要在21世纪运营一个安全的网站，你需要遵循一些安全准则，我会写一个系列专">



  <link rel="alternate" href="/atom.xml" title="随笔" type="application/atom+xml"/>




  <link rel="canonical" href="http://mrzzcn.github.io/2019/01/11/HTTP-Security-Headers/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>强化网站安全 - 第一篇：安全相关的Headers (Hardening Website Security – Part 1: HTTP Security Headers) | 随笔</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">随笔</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">技术 | 生活</h1>
      
    
    
      <a>
        <img class="custom-logo-image" src="/imgs/logo.png" alt="随笔"/>
      </a>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br/>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">

    
    
    
      
    

    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br/>Schedule</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/mrzzcn" class="github-corner" title="Follow me" aria-label="Follow me" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://mrzzcn.github.io/2019/01/11/HTTP-Security-Headers/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack"/>
      <meta itemprop="description" content="屈子泪，离歌起，力拔山兮"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随笔"/>
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">强化网站安全 - 第一篇：安全相关的Headers (Hardening Website Security – Part 1: HTTP Security Headers)

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: Jan 11 2019 15:40:44" itemprop="dateCreated datePublished" datetime="2019-01-11T15:40:44+08:00">Jan 11 2019</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: Apr 27 2019 09:43:35" itemprop="dateModified" datetime="2019-04-27T09:43:35+08:00">Apr 27 2019</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Translate/" itemprop="url" rel="index"><span itemprop="name">Translate</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Translate/Technology/" itemprop="url" rel="index"><span itemprop="name">Technology</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>原文：<a href="https://int64software.com/blog/2018/11/05/hardening-website-security-part-1-http-security-headers/" target="_blank" rel="noopener">Hardening Website Security – Part 1: HTTP Security Headers</a></p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>感觉每周都会出现新的个人信息被盗事件，原因是某一家公司网站被<strong>黑</strong>了。   </p>
<p>大部分攻击都是通过社会工程学诱骗某些用户主动提交一些信息，黑客借助这些信息获取更高权限并最终获取个人资料。   </p>
<p>如果你想要在21世纪运营一个安全的网站，你需要遵循一些安全准则，我会写一个系列专栏说明这些安全准则，这是第一篇。<br><a id="more"></a></p>
<h2 id="本文不会介绍以下内容"><a href="#本文不会介绍以下内容" class="headerlink" title="本文不会介绍以下内容"></a>本文不会介绍以下内容</h2><p>因为网络基础架构的安全配置内容太多（自托管或者VPS，OS，管理中台，防火墙等）而且细微差异众多，我不会在这个系列中介绍。我可能后面会专门写相关文章介绍那些内容。</p>
<h2 id="免责声明"><a href="#免责声明" class="headerlink" title="免责声明"></a>免责声明</h2><blockquote>
<p>文章内容来自于我多年的工作经验、尝试，以及（频繁）犯错的总结。在正常经营的网站忽略<code>HTTP headers</code> 设置（极有）可能导致一些意外的甚至是灾难性的后果。本文所写内容都是个人依据自身知识水平总结的最佳实践，但是涉及到<strong>安全</strong>问题，我强烈建议读者在对你自己的系统或网站做任何改动之前确保你知道自己在干什么以及这么干的后果。本文所有的代码仅作示例展示，可能并不完善甚至有一些错误。读者从网页上拷贝粘贴使用代码时需要格外小心，<abbr title="指原文发表平台 int64software">这个网站</abbr>也包含在内。<abbr title="指原文发表平台所属公司">Int64 Software Ltd</abbr>公司所有员工与企业法人代表不对因故意或无意误用其帖子和文章中所提供信息而造成的损害承担任何责任。   </p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>当Web服务器接收一个标准的 HTTP Get 请求之后，它会把请求的资源和一些Header信息一起返回。这对于浏览器如何处理响应数据来说是必要的，比如资源的编码，内容长度等。</p>
<p>第一篇我们先来看一下安全相关的 Header有哪些，他们的作用以及如何设置他们。</p>
<h2 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h2><p>网站托管环境不同，设置Header的方法不同。下面是一些常用的比较流行的服务器软件/编程语言的Header配置方法。</p>
<h3 id="Apache-Web-Server"><a href="#Apache-Web-Server" class="headerlink" title="Apache Web Server"></a>Apache Web Server</h3><p>Apache的虚拟主机配置文件位于<code>.htaccess</code> 或<code>.httpd.conf</code>，使用以下指令设置：<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header set <span class="string">[HeaderName]</span> <span class="string">[HeaderValue]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>在Nginx 的<code>config</code> 目录下，打开<code>nginx.conf</code>，添加以下内容：<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_header </span>[HeaderName] <span class="string">"[HeaderValue]"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h3><p>(译者加: 在每个虚拟主机目录下)打开<code>Web.Config</code>文件，在<code>&lt;system.webServer&gt;</code>节点下添加<code>&lt;customHeaders&gt;</code>节点：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">httpProtocol</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">customHeaders</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"[HeaderName]"</span> <span class="attr">value</span>=<span class="string">"[HeaderValue]"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">customHeaders</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">httpProtocol</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><p>PHP 可以在文件顶部（在任意输出内容设置之前，包括空白）使用<code>header</code> 方法设置：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">'[HeaderName]: [HeaderValue]'</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>备注：一个请求只需要设置一次Header，不需要在每个包含的PHP文件里面配置。<code>true</code> 表示会覆盖已存在的同名 Header 。</p>
</blockquote>
<h3 id="Asp-Net"><a href="#Asp-Net" class="headerlink" title="Asp.Net"></a><span>Asp.Net</span></h3><p>在<code>global.asax</code> 文件增加以下代码：<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Application_BeginRequest</span>(<span class="params"><span class="keyword">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HttpContext.Current.Response.AddHeader(<span class="string">"[HeaderName]"</span>, <span class="string">"[HeaderValue]"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h2><h3 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h3><p><code>X-Frame-Options</code>用来防止 <strong>点击劫持</strong>，点击劫持指的是攻击者试图在用户浏览/使用网页过程中在诸如点击按钮等事件中执行一些非预期的操作。其中常见的一种攻击方式是 攻击者在他们自己的钓鱼网站上通过<code>iframe</code> 嵌入你的网页，然后在界面上覆盖一个透明的区域，用户以为在浏览你的网页，其实用户提交的信息已经被攻击者盗取。<br>通过设置<code>X-Frame-Options</code> 你可以告诉浏览器当前网页不允许通过<code>iframe</code> 加载。<br>该选项有三个可选值：</p>
<h4 id="DENY"><a href="#DENY" class="headerlink" title="DENY"></a>DENY</h4><p>设置为<code>DENY</code>可以阻止任何其他网页通过<code>iframe</code>嵌入你的网页。除非你的网页明确需要被嵌入，否则请设置为这个值。</p>
<h4 id="SAMEORIGIN"><a href="#SAMEORIGIN" class="headerlink" title="SAMEORIGIN"></a>SAMEORIGIN</h4><p>设置为<code>SAMEORIGIN</code>会允许你自己的网站（同一域名），但是会阻止其他域（包括其他子域）嵌入你的网页。</p>
<h4 id="ALLOW-FROM-lt-uri-gt"><a href="#ALLOW-FROM-lt-uri-gt" class="headerlink" title="ALLOW-FROM &lt;uri\&gt;"></a>ALLOW-FROM &lt;uri\&gt;</h4><p>这种方式将阻止除指定URI以外的其他所有网页使用iframe加载当前网页(比如<code>ALLOW-FROM https://myothersite.com</code>)。</p>
<blockquote>
<p>注意：该选项的浏览器支持性有限</p>
</blockquote>
<h4 id="推荐配置"><a href="#推荐配置" class="headerlink" title="推荐配置"></a>推荐配置</h4><p>X-Frame-Options 应当总是设置为<code>DENY</code>，除非有明确的需要配置为其他值</p>
<h4 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h4><p>X-Frame-Options 选项目前仍然被广泛支持，但是稍后即将讨论的CSP的<code>frame-src</code>选项可以替代这个功能。但是IE对CSP的支持从IE11 开始，而IE8以上已经支持X-Frame-Options，所以它仍然需要配置。</p>
<h3 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h3><p>X-XSS-Protection 被设计用于阻止跨站简本攻击(XSS)，<code>X-XSS-Protection</code>选项将开启浏览器的XSS过滤功能。XSS的攻击者通过注入恶意脚本（例如通过未经安全过滤的用户输入框）到网页，在用户浏览时影响网页正常展示或者偷取浏览者个人数据。<br>最近有一起XSS攻击事件，攻击者通过脆弱的广告网络注入恶意脚本。攻击者有可能会把用户的付款信息转向他自己而不是用户所使用网页的提供者。<br><code>X-XSS-Protection</code>可以通知浏览器过滤并阻止XSS攻击进而降低安全风险，它有四种取值：</p>
<h4 id="0"><a href="#0" class="headerlink" title="0."></a>0.</h4><p><strong>不启用</strong>（不推荐）</p>
<h4 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h4><p><strong>启用</strong>，如果检测到攻击代码，将会删除恶意代码并继续展示网页。通常是默认值。</p>
<h4 id="1-mode-block"><a href="#1-mode-block" class="headerlink" title="1; mode=block"></a>1; mode=block</h4><p><strong>启用</strong>，如果检测到攻击代码，将会阻止网页继续展示。</p>
<h4 id="1-report-lt-reporting-uri-gt"><a href="#1-report-lt-reporting-uri-gt" class="headerlink" title="1; report=&lt;reporting-uri&gt;"></a>1; report=&lt;reporting-uri&gt;</h4><p><strong>启用</strong>，如果检测到攻击代码，将会阻止并清理网页，然后向指定的uri报告恶意攻击事件。</p>
<h4 id="推荐配置-1"><a href="#推荐配置-1" class="headerlink" title="推荐配置"></a>推荐配置</h4><p>X-XSS-Protection应该设置为1，然后看情况开启block或report选项</p>
<h4 id="其他说明-1"><a href="#其他说明-1" class="headerlink" title="其他说明"></a>其他说明</h4><p>与<code>X-Frame-Options</code>类似，CSP可以设置更强大和安全的策略，可以彻底禁止页面内联脚本的执行。稍后讨论。</p>
<h3 id="X-Content-Type-Options"><a href="#X-Content-Type-Options" class="headerlink" title="X-Content-Type-Options"></a>X-Content-Type-Options</h3><p>X-Content-Type-Options只有一个取值<code>nosniff</code>，也只有一个目的：阻止浏览器使用<code>Content-Type</code>以外的类型处理当前内容。<br>当浏览器收到一个文件之后，Content-Type会告诉浏览器这个文件的类型，浏览器自己也会使用多种技术做内容嗅探（或者媒体类型嗅探或MIME嗅探），搞清楚文件的具体类型然后相应处理。<br>然后，在此过程中可能出现用户期望的文件类型与事实不符的情况，这有可能导致跨站脚本攻击或恶意软件分发。</p>
<h4 id="推荐配置-2"><a href="#推荐配置-2" class="headerlink" title="推荐配置"></a>推荐配置</h4><p>上面已经说了，应当总是设置X-Content-Type-Options为<code>nosniff</code>，阻止浏览器默认行为。</p>
<h3 id="Strict-Transport-Security"><a href="#Strict-Transport-Security" class="headerlink" title="Strict-Transport-Security"></a>Strict-Transport-Security</h3><p>HTTP Strict Transport Security，通常简称为HSTS，用来通知浏览器使用安全的HTTPS连接而不是未加密的 HTTP 协议。<br>有两种取值：</p>
<h4 id="max-age-lt-MaxAgeInSeconds-gt"><a href="#max-age-lt-MaxAgeInSeconds-gt" class="headerlink" title="max-age=&lt;MaxAgeInSeconds&gt;"></a>max-age=&lt;MaxAgeInSeconds&gt;</h4><p>表示在未来的一段时间（单位为秒）内浏览器需要记住当前站点只能通过 HTTPS 访问。</p>
<h4 id="includeSubDomains"><a href="#includeSubDomains" class="headerlink" title="includeSubDomains"></a>includeSubDomains</h4><p>可选值，如果指定，表示当前站点的所有子域名也需要使用 HTTPS 连接访问</p>
<h4 id="preload（译者加）"><a href="#preload（译者加）" class="headerlink" title="preload（译者加）"></a>preload（译者加）</h4><p>可选值。<br>谷歌维护着一个 <a href="https://hstspreload.appspot.com/" target="_blank" rel="noopener">HSTS 预加载服务</a>。按照如下指示成功提交你的域名后，浏览器将会永不使用非安全的方式连接到你的域名。虽然该服务是由谷歌提供的，但所有浏览器都有使用这份列表的意向（或者已经在用了）。<strong>但是，这不是 HSTS 标准的一部分，也不该被当作正式的内容。</strong></p>
<h4 id="推荐配置-3"><a href="#推荐配置-3" class="headerlink" title="推荐配置"></a>推荐配置</h4><p>Strict-Transport-Security 应当设置为稍微大一些的值例如1年（31536000 秒）。<code>includeSubDomains</code>选项可以看情况设置。<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Strict</span>-Transport-Security: <span class="built_in">max</span>-age=<span class="number">31536000</span>; includeSubDomains</span><br></pre></td></tr></table></figure></p>
<h3 id="Content-Security-Policy"><a href="#Content-Security-Policy" class="headerlink" title="Content-Security-Policy"></a>Content-Security-Policy</h3><p>最重要也最复杂的Header可能就是CSP，很多浏览器已经支持。如果配置得当，单一的CSP就可以为你的网站保驾护航。但是如果配置错误，也可能影响巨大。<br>CSP的功能主要就是指示浏览器可以从哪里下载脚背以及服务器资源。<br>一个CSP Header包含两部分：一个指令以及一个资源列表。指令指示当前设置的资源类型，资源列表限制当前指令可以下载的源。<br>注意，CSP可以包含多个策略，你可以在一个Header里面通过分号(;)分隔多条指令，也可以设置多个CSP Header。<br>比如，我想要配置JS文件从我们自己的服务器和一个JS 存储仓库(js.example.com)下载，样好似文件仅从我们自己的服务器下载，我可以通过单一Header 设置：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">"Content-Security-Policy: script-src 'self' js.example.com; style-src 'self';"</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>或者通过多个Header 设置：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">"Content-Security-Policy: script-src 'self' js.example.com;"</span>, <span class="keyword">false</span>);</span><br><span class="line">header(<span class="string">"Content-Security-Policy: style-src 'self';"</span>, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意最后一个参数表示替换已存在同名Header需要改为<code>false</code>，用来同时设置多个同名Header。</p>
</blockquote>
<h4 id="指令类型"><a href="#指令类型" class="headerlink" title="指令类型"></a>指令类型</h4><h4 id="default-src"><a href="#default-src" class="headerlink" title="default-src"></a>default-src</h4><p>default-src 代表默认指令，如果正在请求的资源类型未明确定义，将会使用 default-src 策略。如果网页有图片请求，但是<code>img-src</code>没有配置，那么就会使用<code>default-src</code>的配置。</p>
<h4 id="child-src-已弃用"><a href="#child-src-已弃用" class="headerlink" title="child-src(已弃用)"></a>child-src(已弃用)</h4><p>之前用来配置 web workers 以及嵌套浏览器执行环境比如 iframe。然而，frames 和 workers 可能需要单独配置不同策略，这个选项已经被<code>frame-src</code>和<code>worker-src</code>取代。</p>
<h4 id="connect-src"><a href="#connect-src" class="headerlink" title="connect-src"></a>connect-src</h4><p>限制脚本可以请求的源（a标签，pings，fetch，XMLHttpRequest，WebSocket，EventSource）</p>
<h4 id="font-src"><a href="#font-src" class="headerlink" title="font-src"></a>font-src</h4><p>限制字体可以请求的源（Google Fonts等）</p>
<h4 id="frame-src"><a href="#frame-src" class="headerlink" title="frame-src"></a>frame-src</h4><p>限制<code>&lt;frame&gt;</code> 和 <code>&lt;iframe&gt;</code>可以加载的源</p>
<h4 id="frame-ancestors"><a href="#frame-ancestors" class="headerlink" title="frame-ancestors"></a>frame-ancestors</h4><p>限制当前页面可以被<code>&lt;frame&gt;</code> 和 <code>&lt;iframe&gt;</code>加载的源，设置为<code>&#39;none&#39;</code>效果与 <code>X-Frame-Options: DENY</code> 相同</p>
<h4 id="img-src"><a href="#img-src" class="headerlink" title="img-src"></a>img-src</h4><p>限制图片可以加载的源</p>
<h4 id="manifest-src"><a href="#manifest-src" class="headerlink" title="manifest-src"></a>manifest-src</h4><p>限制 Application manifest 文件可以加载的源</p>
<h4 id="media-src"><a href="#media-src" class="headerlink" title="media-src"></a>media-src</h4><p>限制媒体（&lt;audio&gt; , &lt;video&gt;, &lt;track&gt;）可以加载的源</p>
<h4 id="object-src"><a href="#object-src" class="headerlink" title="object-src"></a>object-src</h4><p>限制 &lt;object&gt;, &lt;embed&gt;, and &lt;applet&gt; 可以加载的源</p>
<h4 id="prefech-src"><a href="#prefech-src" class="headerlink" title="prefech-src"></a>prefech-src</h4><p>限制预请求或预渲染的源</p>
<h4 id="script-src"><a href="#script-src" class="headerlink" title="script-src"></a>script-src</h4><p>限制JS脚本的源。应当按需求配置为<code>&#39;self&#39;</code>以及可信的第三方CDN源。<strong>永远不要允许</strong><code>&#39;unsafe-inline&#39;</code>，否则内联脚本的执行可能会导致XSS攻击，从而破坏整个CSP配置的功能。</p>
<h4 id="style-src"><a href="#style-src" class="headerlink" title="style-src"></a>style-src</h4><p>限制CSS样式的源</p>
<h4 id="webrtc-src"><a href="#webrtc-src" class="headerlink" title="webrtc-src"></a>webrtc-src</h4><p>限制WebRTC(Web Real-Time Communications)可以连接的源</p>
<h4 id="worker-src"><a href="#worker-src" class="headerlink" title="worker-src"></a>worker-src</h4><p>限制Worker/SharedWorker/ServiceWorker脚本的源</p>
<h4 id="form-action"><a href="#form-action" class="headerlink" title="form-action"></a>form-action</h4><p>限制表单提交的源</p>
<h4 id="report-uri"><a href="#report-uri" class="headerlink" title="report-uri"></a>report-uri</h4><p>指定破坏CSP规则上报的uri</p>
<h4 id="block-all-mixed-content"><a href="#block-all-mixed-content" class="headerlink" title="block-all-mixed-content"></a>block-all-mixed-content</h4><p>如果页面是通过HTTPS加载的，跳过所有HTTP资源请求</p>
<h4 id=""><a href="#" class="headerlink" title="*"></a>*</h4><p>允许所有data stream(blob:, data:, filesystem:)以外的源</p>
<h4 id="‘none’"><a href="#‘none’" class="headerlink" title="‘none’"></a>‘none’</h4><p>禁止当前资源类型从任意源加载</p>
<h4 id="‘self’"><a href="#‘self’" class="headerlink" title="‘self’"></a>‘self’</h4><p>当前页面所在源（同协议，同主机名，同端口）</p>
<h4 id="Data"><a href="#Data" class="headerlink" title="Data:"></a>Data:</h4><p>数据流（例如base64 编码的图片地址）</p>
<h4 id="domain-example-com"><a href="#domain-example-com" class="headerlink" title="domain.example.com"></a>domain.example.com</h4><p>某一个指定域名</p>
<h4 id="example-com"><a href="#example-com" class="headerlink" title="*.example.com"></a>*.example.com</h4><p>某一个指定域名以及所有子域名</p>
<h4 id="https-domain-example-com"><a href="#https-domain-example-com" class="headerlink" title="https://domain.example.com"></a><em><a href="https://domain.example.com" target="_blank" rel="noopener">https://domain.example.com</a></em></h4><p>某一个指定域名并且只能通过HTTPS 连接</p>
<h4 id="https"><a href="#https" class="headerlink" title="https:"></a>https:</h4><p>任意通过HTTPS连接的域名</p>
<h4 id="‘unsafe-inline’"><a href="#‘unsafe-inline’" class="headerlink" title="‘unsafe-inline’"></a>‘unsafe-inline’</h4><p>允许内联代码，包括内联样式或脚本块（请尽量避免使用）</p>
<h4 id="‘unsafe-eval’"><a href="#‘unsafe-eval’" class="headerlink" title="‘unsafe-eval’"></a>‘unsafe-eval’</h4><p>允许javascript<code>eval()</code>方法</p>
<h4 id="‘nonce-lt-noncevalue-gt-’"><a href="#‘nonce-lt-noncevalue-gt-’" class="headerlink" title="‘nonce-&lt;noncevalue&gt;’"></a>‘nonce-&lt;noncevalue&gt;’</h4><p>可以在script/style标签上增加一个随机数，只有随机数与noncevalue匹配时，相应标签代码才可以执行。注意这个策略已经破解，可能不安全。</p>
<h4 id="‘sha256-lt-hashvalue-gt-’"><a href="#‘sha256-lt-hashvalue-gt-’" class="headerlink" title="‘sha256-&lt;hashvalue&gt;’"></a>‘sha256-&lt;hashvalue&gt;’</h4><p>script/style的SHA256哈希值与hashvalue匹配，相应代码才可以执行</p>
<h4 id="推荐配置-4"><a href="#推荐配置-4" class="headerlink" title="推荐配置"></a>推荐配置</h4><p>这一项很难有一个通用的确切值，因为需要根据每个网站具体配置。我的做法（在任何安全相关的问题）是尽可能把规则配的具体，然后找到冲突的点，解决冲突或者放松规则，直到所有的配置都正常工作。这里也可以这么做，但是请考虑以下情况：<br>比如<code>style-src</code>，我们很容易就会配置为<code>&#39;self&#39;</code>策略，表示只能从本域加载 (.css) 文件。但你的代码里面可能会有少量内联样式，这时候怎么处理呢？最好是把这些内联样式都移到某一个文件里面，这并不总是可以很简单的完成，你可能会需要允许<code>&#39;unsafe-inline&#39;</code>。<br>我觉得一个比较好的方式是通过一项项查看我的某个项目的CSP配置，说明一下我为什么这么配置，以及这么配置的负面影响。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span>-src <span class="string">'none'</span>;</span><br></pre></td></tr></table></figure></p>
<p>默认配置为拒绝所有未指定资源类型的任意加载源。考虑到我已经仔细检查了其他所有资源类型的加载策略，不应该有资源会回退到这个配置，如果有，那么这个资源一定不是由我添加的。注意：其他人在新增资源但是无法加载时可能来找你麻烦，因此很多人会设置为<code>&#39;self&#39;</code>。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script-src <span class="string">'self'</span> <span class="string">https:</span><span class="comment">//js.stripe.com;</span></span><br></pre></td></tr></table></figure></p>
<p>所有的脚本都已经打包、压缩，因此不应该出现内联脚本，应当配置为<code>&#39;self&#39;</code>。另外，我使用 Stripe 作为支付网关，所以要允许 Stripe 的脚本库。<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>-src <span class="string">'self'</span> https:<span class="comment">//api.stripe.com;</span></span><br></pre></td></tr></table></figure></p>
<p>我的应用大量使用Ajax请求，所以需要添加<code>&#39;self&#39;</code>。Stripe 也需要使用脚本请求接口，所以也添加了 Stripe 的服务域名。<br><figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">img-src</span> <span class="string">'self'</span> data:;</span><br></pre></td></tr></table></figure></p>
<p>80年代的网页有一个明显的问题就是所有的图片都是由自己的服务器托管，所以需要<code>&#39;self&#39;</code>。当然，网页里面也会用到内联SVG图像，所以包含了<code>&#39;data:&#39;</code>。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">style-src <span class="string">'self'</span> <span class="string">'unsafe-inline'</span> <span class="string">https:</span><span class="comment">//fonts.googleapis.com;</span></span><br></pre></td></tr></table></figure></p>
<p>样式主要都是自己服务器托管，少量使用 Google Fonts，所以添加了<code>&#39;self&#39;</code>和Google Fonts。很惭愧我（虽然很少但是偶尔会）也使用了页面内联样式，所以我添加了<code>&#39;unsafe-inline&#39;</code>。注意：已经有证据证明可以通过CSS注入读取表单信息，所以你需要额外注意使用这个策略可能导致的应用程序脆弱性。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">font-src <span class="string">'self'</span> <span class="string">https:</span><span class="comment">//fonts.gstatic.com;</span></span><br></pre></td></tr></table></figure></p>
<p>这个也相当简单，我要用到我们自己的和 Google 提供的字体，所以添加了<code>&#39;self&#39;</code>和Google的字体库。<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frame-src <span class="string">'self'</span> https:<span class="regexp">//</span>*.stripe.com https:<span class="regexp">//</span>stripe.com;</span><br></pre></td></tr></table></figure></p>
<p>这个略微有些复杂，Stripe 允许使用 <em>3D Secure</em> 保护卡的授权登录。不幸的是，对方推荐的实现方式是使用 Iframe（我也讨厌）。所以我这里添加 Stripe 作为支付网关，<code>&#39;self&#39;</code>做为授权完成之后 Iframe 的回跳地址。<br>如果你也使用Stripe，你可能知道他们的文档说明只需要添加 <strong><a href="https://js.stripe.com" target="_blank" rel="noopener">https://js.stripe.com</a></strong> 作为 frame source，但是我操作的过程中发现一些问题，我正在与他们的技术支持团队合作把这个策略尽量收紧。<br><figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">frame-ancestors</span> <span class="string">'none'</span>;</span><br></pre></td></tr></table></figure></p>
<p>之前已经提到，这项配置可以禁止当前网页被任何网站通过 Iframe 嵌入加载。注意：我在 <em>3D Secure</em> 的授权回跳页面上面把这项配置放送到<code>&#39;self&#39;</code>，这样我自己的网站才可以通过Iframe加载回跳页面。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">report</span>-uri /csp-<span class="keyword">report</span>.php;</span><br></pre></td></tr></table></figure></p>
<p>所有破坏CSP规则的异常都会被上报（由客户端浏览器）到这个地址，记录下来以后分析使用。<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">block</span>-all-mixed-<span class="built_in">content</span>;</span><br></pre></td></tr></table></figure></p>
<p>最后，尽管我没有任何混合内容（译者：与页面协议不一致的加载方式，例如页面使用HTTPS，而某一图片使用HTTP），防止意外我还是添加了这条禁止策略。</p>
<p>其他指令的注意点：　　　<br>绝大部分其他指令策略都会回退到 default-src 然后被禁止。有一个例外：worker-src 在很多浏览器（Chrome 59以上会忽略child-src直接回退到default-src, Edge 17 会忽略 script-src）中会回退到 child-src -&gt; script-src 。<br>不设置 <strong>plugin-types</strong> 指令，在技术上会默认允许所有的扩展类型 (&lt;embed&gt;, &lt;object&gt;, &lt;applet&gt;)，但同时我们没有配置 <strong>object-src</strong>，这项策略会降级到 <strong>default-src</strong> 从而在加载层面禁止所有的扩展。</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><h3 id="Apache-Web-Server-1"><a href="#Apache-Web-Server-1" class="headerlink" title="Apache Web Server"></a>Apache Web Server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Header <span class="built_in">set</span> X-Frame-Options <span class="string">"SAMEORIGIN"</span></span><br><span class="line">Header <span class="built_in">set</span> X-XSS-Protection <span class="string">"1; mode=block"</span></span><br><span class="line">Header <span class="built_in">set</span> X-Content-Type-Options <span class="string">"nosniff"</span></span><br><span class="line">Header <span class="built_in">set</span> Strict-Transport-Security <span class="string">"max-age=31536000; includeSubDomains"</span></span><br><span class="line">Header <span class="built_in">set</span> Content-Security-Policy <span class="string">"default-src 'none'; script-src 'self' https://js.stripe.com; connect-src 'self' https://api.stripe.com; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https://*.stripe.com https://stripe.com; frame-ancestors 'none'; report-uri /csp_report.php; block-all-mixed-content;"</span></span><br></pre></td></tr></table></figure>
<h3 id="Nginx-1"><a href="#Nginx-1" class="headerlink" title="Nginx"></a>Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add_header X-Frame-Options <span class="string">"SAMEORIGIN"</span></span><br><span class="line">add_header X-XSS-Protection <span class="string">"1; mode=block"</span></span><br><span class="line">add_header X-Content-Type-Options <span class="string">"nosniff"</span></span><br><span class="line">add_header Strict-Transport-Security <span class="string">"max-age=31536000; includeSubDomains"</span></span><br><span class="line">add_header Content-Security-Policy <span class="string">"default-src 'none'; script-src 'self' https://js.stripe.com; connect-src 'self' https://api.stripe.com; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https://*.stripe.com https://stripe.com; frame-ancestors 'none'; report-uri /csp_report.php; block-all-mixed-content;"</span></span><br></pre></td></tr></table></figure>
<h3 id="IIS-1"><a href="#IIS-1" class="headerlink" title="IIS"></a>IIS</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">httpProtocol</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">customHeaders</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"X-Frame-Options"</span> <span class="attr">value</span>=<span class="string">"SAMEORIGIN"</span> /&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"X-XSS-Protection"</span> <span class="attr">value</span>=<span class="string">"1; mode=block"</span> /&gt;</span></span><br><span class="line">   	    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"X-Content-Type-Options"</span> <span class="attr">value</span>=<span class="string">"nosniff"</span> /&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"Strict-Transport-Security"</span> <span class="attr">value</span>=<span class="string">"max-age=31536000; includeSubDomains"</span>/&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"Content-Security-Policy"</span> <span class="attr">value</span>=<span class="string">"default-src 'none'; script-src 'self' https://js.stripe.com; connect-src 'self' https://api.stripe.com; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https://*.stripe.com https://stripe.com; frame-ancestors 'none'; report-uri /csp_report.php; block-all-mixed-content;"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">customHeaders</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">httpProtocol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="PHP-1"><a href="#PHP-1" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">'[HeaderName]: [HeaderValue]'</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">header(<span class="string">'X-Frame-Options: SAMEORIGIN'</span>);</span><br><span class="line">header(<span class="string">'X-XSS-Protection: 1; mode=block'</span>);</span><br><span class="line">header(<span class="string">'X-Content-Type-Options: nosniff'</span>);</span><br><span class="line">header(<span class="string">'Strict-Transport-Security: max-age=31536000; includeSubDomains'</span>);</span><br><span class="line">header(<span class="string">'Content-Security-Policy: default-src \'none\'; script-src \'self\' https://js.stripe.com; connect-src \'self\' https://api.stripe.com; img-src \'self\' data:; style-src \'self\' \'unsafe-inline\' https://fonts.googleapis.com; font-src \'self\' https://fonts.gstatic.com; frame-src \'self\' https://*.stripe.com https://stripe.com; frame-ancestors \'none\'; report-uri /csp_report.php; block-all-mixed-content;'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ASP-NET"><a href="#ASP-NET" class="headerlink" title="ASP.NET"></a><span>ASP.NET</span></h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Application_BeginRequest</span>(<span class="params"><span class="keyword">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HttpContext.Current.Response.AddHeader(<span class="string">"X-Frame-Options"</span>, <span class="string">"SAMEORIGIN"</span>);</span><br><span class="line">    HttpContext.Current.Response.AddHeader(<span class="string">"X-XSS-Protection"</span>, <span class="string">"1; mode=block"</span>);</span><br><span class="line">    HttpContext.Current.Response.AddHeader(<span class="string">"X-Content-Type-Options"</span>, <span class="string">"nosniff"</span>);</span><br><span class="line">    HttpContext.Current.Response.AddHeader(<span class="string">"Strict-Transport-Security"</span>, <span class="string">"max-age=31536000; includeSubDomains"</span>);</span><br><span class="line">    HttpContext.Current.Response.AddHeader(<span class="string">"Content-Security-Policy"</span>, </span><br><span class="line">      <span class="string">"default-src 'none'; script-src 'self' https://js.stripe.com; connect-src 'self' https://api.stripe.com; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https://*.stripe.com https://stripe.com; frame-ancestors 'none'; report-uri /csp_report.php; block-all-mixed-content;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="下集预告"><a href="#下集预告" class="headerlink" title="下集预告"></a>下集预告</h2><p>请先阅读有关使用 HSTS Preloading 的<a href="https://int64software.com/blog/2018/11/10/hardening-website-security-part-1a-hsts-preloading/" target="_blank" rel="noopener">附录</a>，然后继续阅读第二篇：<a href="https://int64software.com/blog/2018/11/13/hardening-website-security-part-2-user-session-cookie-security/" target="_blank" rel="noopener">Cookie攻防实战</a>。<br>关注作者：<a href="https://twitter.com/Int64Software" target="_blank" rel="noopener">Twitter</a><br>译者微薄：<a href="https://weibo.com/zzspace" target="_blank" rel="noopener">新浪微博</a></p>
<h2 id="刊误"><a href="#刊误" class="headerlink" title="刊误"></a>刊误</h2><p>如果你有任何意见或建议，请联系：<a href="mailto:support@int64software.com" target="_blank" rel="noopener">support@int64software.com</a> 。<br>译者邮箱：<a href="mailto:mrzzcn+blog@gmail.com" target="_blank" rel="noopener">mrzzcn@gmail.com</a> 。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Jack</li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    
    <a href="http://mrzzcn.github.io/2019/01/11/HTTP-Security-Headers/" title="强化网站安全 - 第一篇：安全相关的Headers (Hardening Website Security – Part 1: HTTP Security Headers)">http://mrzzcn.github.io/2019/01/11/HTTP-Security-Headers/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Web/" rel="tag"># Web</a>
          
            <a href="/tags/HTTP/" rel="tag"># HTTP</a>
          
            <a href="/tags/Headers/" rel="tag"># Headers</a>
          
            <a href="/tags/Security/" rel="tag"># Security</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/28/bfc/" rel="next" title="BFC">
                <i class="fa fa-chevron-left"></i> BFC
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/27/host-yapi-with-heroku-and-mongodb-atlas/" rel="prev" title="使用 Heroku 和 mongoDB Atlas 免费托管 YApi">
                使用 Heroku 和 mongoDB Atlas 免费托管 YApi <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="gitalk-container">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jack</p>
              <div class="site-description motion-element" itemprop="description">屈子泪，离歌起，力拔山兮</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/mrzzcn" title="GitHub &rarr; https://github.com/mrzzcn" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:mrzzcn@gmail.com" title="E-Mail &rarr; mailto:mrzzcn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/zzspace" title="Weibo &rarr; https://weibo.com/zzspace" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/mrzhangzhen" title="Twitter &rarr; https://twitter.com/mrzhangzhen" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"/></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本文不会介绍以下内容"><span class="nav-number">2.</span> <span class="nav-text">本文不会介绍以下内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#免责声明"><span class="nav-number">3.</span> <span class="nav-text">免责声明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">4.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置服务器"><span class="nav-number">5.</span> <span class="nav-text">配置服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Apache-Web-Server"><span class="nav-number">5.1.</span> <span class="nav-text">Apache Web Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx"><span class="nav-number">5.2.</span> <span class="nav-text">Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IIS"><span class="nav-number">5.3.</span> <span class="nav-text">IIS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP"><span class="nav-number">5.4.</span> <span class="nav-text">PHP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asp-Net"><span class="nav-number">5.5.</span> <span class="nav-text">Asp.Net</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Headers"><span class="nav-number">6.</span> <span class="nav-text">Headers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#X-Frame-Options"><span class="nav-number">6.1.</span> <span class="nav-text">X-Frame-Options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#X-XSS-Protection"><span class="nav-number">6.2.</span> <span class="nav-text">X-XSS-Protection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#X-Content-Type-Options"><span class="nav-number">6.3.</span> <span class="nav-text">X-Content-Type-Options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Strict-Transport-Security"><span class="nav-number">6.4.</span> <span class="nav-text">Strict-Transport-Security</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Content-Security-Policy"><span class="nav-number">6.5.</span> <span class="nav-text">Content-Security-Policy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码示例"><span class="nav-number">7.</span> <span class="nav-text">代码示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Apache-Web-Server-1"><span class="nav-number">7.1.</span> <span class="nav-text">Apache Web Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx-1"><span class="nav-number">7.2.</span> <span class="nav-text">Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IIS-1"><span class="nav-number">7.3.</span> <span class="nav-text">IIS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP-1"><span class="nav-number">7.4.</span> <span class="nav-text">PHP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASP-NET"><span class="nav-number">7.5.</span> <span class="nav-text">ASP.NET</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下集预告"><span class="nav-number">8.</span> <span class="nav-text">下集预告</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#刊误"><span class="nav-number">9.</span> <span class="nav-text">刊误</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  
    

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"/>



<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: 'da5de7af34d6bdf63448',
    clientSecret: 'bc5cee0c5330f2930f633a7228aff5d73103f869',
    repo: 'mrzzcn.github.io',
    owner: 'mrzzcn',
    admin: ['mrzzcn'],
    id: md5(location.pathname),
    
      language: window.navigator.language || window.navigator.userLanguage,
    
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script>

  


  




  

  

  
  

  
  

  


  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
